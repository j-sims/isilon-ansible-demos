# isilon-ansible-demos

## Introduction
These scripts are provided as an example of how to templatize the provisioning of [Isilon](https://www.dellemc.com/en-us/storage/isilon/) shares/exports using [Ansible](https://www.ansible.com/) and the [Isilon API](https://blog.dellemc.com/en-us/introducing-the-isilon-api-info-hub/).

For each python script there is a corresponding JSON file for defining the config of shares/export/snapshotschedules/quotas for any number of clusters. Executing the python script parses the JSON file config template and returns an Ansible compatible playbook that can be executed via the ansible-playbook command (provided with Ansible).

As provided, these scripts are a demonstration of how to leverage Ansible and the Isilon API to templatize the deployment of configurations. JSON was chosen for the template due to the nested nature of the data and JSON ease of use with python. Additionally, the JSON file is easily generated by most orchestration platforms and webapps.

A sample workflow might consist of a Web Application that allows the end user to select share/export, define quotas, and snapshotschedules. The theoretical webapp might then generate the formatted JSON file containing the requested items and then call the python script to create the ansible playbook. The playbook provides the history of the config and is used to deploy the share/export config to any number of clusters.

This architecture of automation is a create-only workflow to eliminate the risk of DU/DL and relies on Ansible as the deployment mechanism.

Since we are leveraging only the Isilon API for integration there are no third-party components that need to be maintained or updated to work with Isilon allowing us to keep current the Ansible integration without the need for additional libraries or modules. This "inherently current" design eliminates one of the common pitfalls of automation in that every time Isilon OneFS is updated so is the builtin API with the endpoint versioning ensuring backwards compatibility.

## Instructions
1. Clone or download the repository:
``` bash
git clone https://github.com/j-sims/isilon-ansible-demos.git
```

2. Rename the JSON file removing "sample-" from the name and edit
```bash
mv sample-simple-shares.json simple-shares.json
vi simple-shares.json
```

3. Execute the python script to create the playbook
```bash
python ansible-simple-shares-demo
```

4. Execute the newly created playbook:
```bash
ansible-playbook playbook-combined-smb-172.16.10.10.yml
```
## Example
```
$ python ansible-simple-synciqpolicies-demo.py
$ ansible-playbook playbook-simple-synciqpolicies-172.16.10.10.yml
/home/jim/.local/lib/python2.7/site-packages/requests/__init__.py:91: RequestsDependencyWarning: urllib3 (1.24.1) or chardet (3.0.4) doesn't match a supported version!
  RequestsDependencyWarning)

PLAY [Isilon New syniq policy with URI module] **********************************************

TASK [Gathering Facts] **********************************************************************
ok: [localhost]

TASK [get isilon API session IDs] ***********************************************************
ok: [localhost]

TASK [Create Policy] ************************************************************************
ok: [localhost]

TASK [Create Policy] ************************************************************************
ok: [localhost]

TASK [Create Policy] ************************************************************************
ok: [localhost]

TASK [Delete isilon API session IDs] ********************************************************
ok: [localhost]

PLAY RECAP **********************************************************************************
localhost                  : ok=6    changed=0    unreachable=0    failed=0   
```
